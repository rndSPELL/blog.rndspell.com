<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Пишем игру с нуля. LibGDX. Часть 2. Структура проекта, экраны и загрузка текстуры. - rndSPELL | Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="http://blog.rndspell.com/images/favicon.png" rel="icon">


    <!-- Open Graph tags -->
        <meta property="og:site_name" content="rndSPELL | Blog" />
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Пишем игру с нуля. LibGDX. Часть 2. Структура проекта, экраны и загрузка текстуры."/>
            <meta property="og:url" content="http://blog.rndspell.com/posts/2014/07/libgdx-game-from-scratch-part2/"/>
            <meta property="og:description" content="Начинаю изучать структуру проекта, подготовленного в предыдущем посте."/>
            <meta property="article:published_time" content="2014-07-16" />
                <meta property="article:section" content="Статьи" />
                <meta property="article:tag" content="gamedev" />
                <meta property="article:tag" content="libGDX" />
                <meta property="article:author" content="Bserg" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.rndspell.com/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.rndspell.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.rndspell.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.rndspell.com/theme/css/style.css" type="text/css"/>

        <link href="http://blog.rndspell.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="rndSPELL | Blog ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.rndspell.com/" class="navbar-brand">
<img src="http://blog.rndspell.com/images/logo.png" width="20"/> rndSPELL | Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://blog.rndspell.com/category/stati">Статьи</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.rndspell.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Архив</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.rndspell.com/posts/2014/07/libgdx-game-from-scratch-part2/"
                       rel="bookmark"
                       title="Permalink to Пишем игру с нуля. LibGDX. Часть 2. Структура проекта, экраны и загрузка текстуры.">
                        Пишем игру с нуля. LibGDX. Часть 2. Структура проекта, экраны и загрузка текстуры.
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Дата</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-07-16T18:00:00"> Ср. 16 Июль 2014</time>
    </span>



<span class="label label-default">Тэги</span>
	<a href="http://blog.rndspell.com/tag/gamedev/">gamedev</a>
        /
	<a href="http://blog.rndspell.com/tag/libgdx/">libGDX</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><em>Первая часть цикла находится <a href="http://blog.rndspell.com/posts/2014/07/libgdx-game-from-scratch-part1/">здесь</a></em></p>
<h3>Структура проекта</h3>
<p>Рассмотрим структуру проекта.</p>
<p><img alt="Структура проекта" src="http://blog.rndspell.com/images/project_structure.png" title="структура проекта" /></p>
<p><em>рис.1 Структура проекта</em></p>
<p>При генерации проекта мы указали только desktop и android, соответственно получили ядро проекта, а так же классы для запуска приложения на pc и android.</p>
<p>В папке <em>core</em> мы видим один класс <em>MyGame</em> наследующий <em>ApplicationAdapter</em>:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyGame</span> <span class="kd">extends</span> <span class="n">ApplicationAdapter</span> <span class="o">{</span>
    <span class="n">SpriteBatch</span> <span class="n">batch</span><span class="o">;</span>
    <span class="n">Texture</span> <span class="n">img</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span> <span class="o">()</span> <span class="o">{</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpriteBatch</span><span class="o">();</span>
        <span class="n">img</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Texture</span><span class="o">(</span><span class="s">&quot;badlogic.jpg&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span> <span class="o">()</span> <span class="o">{</span>
        <span class="n">Gdx</span><span class="o">.</span><span class="na">gl</span><span class="o">.</span><span class="na">glClearColor</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="n">Gdx</span><span class="o">.</span><span class="na">gl</span><span class="o">.</span><span class="na">glClear</span><span class="o">(</span><span class="n">GL20</span><span class="o">.</span><span class="na">GL_COLOR_BUFFER_BIT</span><span class="o">);</span>
        <span class="n">batch</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>
        <span class="n">batch</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">batch</span><span class="o">.</span><span class="na">end</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Это основной класс игры.</p>
<p>Так же посмотрим, что мы имеем в папке <em>desktop</em>:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DesktopLauncher</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">LwjglApplicationConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LwjglApplicationConfiguration</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">LwjglApplication</span><span class="o">(</span><span class="k">new</span> <span class="n">MyGame</span><span class="o">(),</span> <span class="n">config</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>


<p>}</p>
<p>и в <em>android</em> части мы имеем класс <em>AndroidLauncher</em>:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AndroidLauncher</span> <span class="kd">extends</span> <span class="n">AndroidApplication</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span> <span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">AndroidApplicationConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AndroidApplicationConfiguration</span><span class="o">();</span>
        <span class="n">initialize</span><span class="o">(</span><span class="k">new</span> <span class="n">MyGame</span><span class="o">(),</span> <span class="n">config</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Для создания игры на мобильные устройства можно до определенного момента не использовать смартфон или планшет для отладки и тестирования игры, а писать и смотреть на результат только на десктопе (кроме случая, когда управление игрой будет принципиально заточено под сенсорный экран и жесты).
Это неоспоримое преимущество фреймворка LibGDX упрощает жизнь разработчика.</p>
<p>Запускаем <em>DesktopLauncher</em> (в intelliJ IDEA запускаем командой <em>Run - Run "DesktopLauncher"</em>) и видим следующее:</p>
<p><img alt="Первый запуск приложения" src="http://blog.rndspell.com/images/first_launch.png" title="запуск сгенерированного проекта" /></p>
<p><em>рис. 2 Запущенное приложение после создания проекта</em></p>
<p>В классе <em>MyGame</em> инициализируются переменные <em>batch</em> и <em>img</em>, первое отвечает за отрисовку текстур на экране, второе - собственно, текстура</p>
<div class="highlight"><pre><span class="n">batch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpriteBatch</span><span class="o">();</span>
<span class="n">img</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Texture</span><span class="o">(</span><span class="s">&quot;badlogic.jpg&quot;</span><span class="o">);</span>
</pre></div>


<p>Далее отрисовывается текстура:</p>
<div class="highlight"><pre><span class="n">batch</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>
<span class="n">batch</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="n">batch</span><span class="o">.</span><span class="na">end</span><span class="o">();</span>
</pre></div>


<p>перед отрисовкой текстур необходимо вызвать <em>batch.begin()</em> и после отрисовки в рамках данного <em>batch</em> вызвать <em>batch.end()</em>.
Текстура <em>img</em> отображается на экране в положении (0, 0), т.е. в начале координат экрана, который находится в левом нижнем углу, начало координат текстуры так же находится в левом нижнем углу.</p>
<p>По большому счету, написать игру целиком с логикой и отображением можно в одном методе <em>render()</em>. Я слышал многие так и делают.
Но у нас будет игра немного сложнее "сапера" или подобной простой игры, и надо хотя бы попытаться написать код игры красиво, логично и понятно.</p>
<p>Для начала класс <em>MyGame</em> будет наследовать класс <em>Game</em>, а не <em>ApplicationAdapter</em>. Класс <em>Game</em> использует экраны, реализующие интерфейс <em>Screen</em>.
Экраны можно запускать при возникновении некоторых событий (например на экране меню, нажмая кнопку "Начать игру" мы запускаем экран GameScreen).
Для запуска используется метод setScreen(Screen screen) класса Game, поэтому для запуска экрана инвентаря например, надо предусмотреть доступ к экземпляру класса Game (например в конструкторе объекта или передавая его в метод), что не всегда красиво и удобно.</p>
<p>На просторах интернета я обнаружил и позаимствовал замечательный код менеджера экранов, реализующего паттерн <a href="http://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D0%BD%D0%B3%D0%BB%D1%82%D0%BE%D0%BD_(%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)" title="Синглтон вики">Синглтон</a>:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScreenManager</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ScreenManager</span> <span class="n">instance</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Game</span> <span class="n">game</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">IntMap</span><span class="o">&lt;</span><span class="n">Screen</span><span class="o">&gt;</span> <span class="n">screens</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">ScreenManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">screens</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntMap</span><span class="o">&lt;</span><span class="n">Screen</span><span class="o">&gt;();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">ScreenManager</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">instance</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScreenManager</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Game</span> <span class="n">game</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">game</span> <span class="o">=</span> <span class="n">game</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(</span><span class="n">CustomScreen</span> <span class="n">screen</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">game</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">screens</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">screen</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">screens</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">screen</span><span class="o">.</span><span class="na">ordinal</span><span class="o">(),</span> <span class="n">screen</span><span class="o">.</span><span class="na">getScreenInstance</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">game</span><span class="o">.</span><span class="na">setScreen</span><span class="o">(</span><span class="n">screens</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">screen</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">(</span><span class="n">CustomScreen</span> <span class="n">screen</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">screens</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">screen</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()))</span> <span class="k">return</span><span class="o">;</span>
        <span class="n">screens</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">screen</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()).</span><span class="na">dispose</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">badlogic</span><span class="o">.</span><span class="na">gdx</span><span class="o">.</span><span class="na">Screen</span> <span class="n">screen</span> <span class="o">:</span> <span class="n">screens</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">screen</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">screens</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Перечисление <em>CustomScreen</em>:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="n">CustomScreen</span> <span class="o">{</span>

    <span class="n">LOAD_SCREEN</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">com</span><span class="o">.</span><span class="na">badlogic</span><span class="o">.</span><span class="na">gdx</span><span class="o">.</span><span class="na">Screen</span> <span class="nf">getScreenInstance</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">LoadScreen</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">},</span>

    <span class="n">MAIN_MENU</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">com</span><span class="o">.</span><span class="na">badlogic</span><span class="o">.</span><span class="na">gdx</span><span class="o">.</span><span class="na">Screen</span> <span class="nf">getScreenInstance</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">MenuScreen</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">},</span>

    <span class="n">GAME</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">com</span><span class="o">.</span><span class="na">badlogic</span><span class="o">.</span><span class="na">gdx</span><span class="o">.</span><span class="na">Screen</span> <span class="nf">getScreenInstance</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">GameScreen</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">},</span>

    <span class="n">BATTLE</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">com</span><span class="o">.</span><span class="na">badlogic</span><span class="o">.</span><span class="na">gdx</span><span class="o">.</span><span class="na">Screen</span> <span class="nf">getScreenInstance</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">BattleScreen</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">com</span><span class="o">.</span><span class="na">badlogic</span><span class="o">.</span><span class="na">gdx</span><span class="o">.</span><span class="na">Screen</span> <span class="nf">getScreenInstance</span><span class="o">();</span>

<span class="o">}</span>
</pre></div>


<p>Данный менеджер дает возможность вызвать переключение экранов из любой точки кода, получая экземлляр класса ScreenManager в виде статической переменной.</p>
<p>Сами экраны, реализующие интерфейс <em>Screen</em> представляет собой следующее:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameScreen</span> <span class="kd">implements</span> <span class="n">Screen</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="kt">float</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resize</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hide</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pause</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resume</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Названия методов говорят сами за себя. При запуске экрана вызывается метдо show(), там можно инициализировать необходимые переменные, метод render() вызывается в основном цикле игры, там будут реализованы все обновления состояний и отображение объектов.
Подробнее с классом <em>Screen</em> можно ознакомится в официальной <a href="http://libgdx.badlogicgames.com/nightlies/docs/api/" title="Документация">документации</a>.</p>
<p>Вернемся к классу MyGame и переопределим метод create():</p>
<div class="highlight"><pre><span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span> <span class="o">()</span> <span class="o">{</span>
    <span class="n">ScreenManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">init</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">ScreenManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">show</span><span class="o">(</span><span class="n">CustomScreen</span><span class="o">.</span><span class="na">LOAD_SCREEN</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<p>здесь инициализируется менеджер экранов и запускается экран загрузки. На экране загрузки, который будет отображаться первым, в память будут подгружаться игровые ресурсы: текстуры, звуки, импортироваться уровни и прочее - после чего игра переключится на главное меню.
А пока главного меню нет экран загрузки просто перебрасывает на экран непосредственно игры:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoadScreen</span> <span class="kd">implements</span> <span class="n">Screen</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">LoadScreen</span><span class="o">(){}</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ScreenManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">show</span><span class="o">(</span><span class="n">CustomScreen</span><span class="o">.</span><span class="na">GAME_SCREEN</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</pre></div>


<p>Для управлением игровыми ресурсами (текстурами, звуками и т.п.) в LibGDX имеется <em>AssetManager</em>. Он позволяет загружать в память ресурсы, контролировать прогресс загрузки (например можно добавить прогресс бар), а так же извлекать загруженные данные.
Расширим этот класс и реализуем синглтон, чтобы так же иметь возможность извлекать необходимые ресурсы игры из любого места:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameAssetManager</span> <span class="kd">extends</span> <span class="n">AssetManager</span><span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">GameAssetManager</span> <span class="n">instance</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">GameAssetManager</span> <span class="nf">getInstance</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">instance</span><span class="o">){</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GameAssetManager</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(){}</span>
<span class="o">}</span>
</pre></div>


<p>и допишем класс экрана загрузки с использованием менеджера ресурсов:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoadScreen</span> <span class="kd">implements</span> <span class="n">Screen</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">LoadScreen</span><span class="o">(){}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">loadAssets</span><span class="o">(){</span>
        <span class="n">GameAssetManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;badlogic.jpg&quot;</span><span class="o">,</span> <span class="n">Texture</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="kt">float</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">GameAssetManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">update</span><span class="o">()){</span>
            <span class="n">ScreenManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">show</span><span class="o">(</span><span class="n">CustomScreen</span><span class="o">.</span><span class="na">MAIN_MENU</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">GameAssetManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">init</span><span class="o">();</span>
        <span class="n">loadAssets</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</pre></div>


<p>Метод <em>update()</em> менеджера ресурсов возвращает <em>true</em>, если ресурсы загружены в память, иначе <em>false</em>.</p>
<p>И получим загруженную текстуру из менеджера ресурсов в <em>GameScreen</em>:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameScreen</span> <span class="kd">implements</span> <span class="n">Screen</span> <span class="o">{</span>

    <span class="n">SpriteBatch</span> <span class="n">batch</span><span class="o">;</span>
    <span class="n">Texture</span> <span class="n">texture</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="kt">float</span> <span class="n">delta</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">Gdx</span><span class="o">.</span><span class="na">gl</span><span class="o">.</span><span class="na">glClearColor</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="n">Gdx</span><span class="o">.</span><span class="na">gl</span><span class="o">.</span><span class="na">glClear</span><span class="o">(</span><span class="n">GL20</span><span class="o">.</span><span class="na">GL_COLOR_BUFFER_BIT</span><span class="o">);</span>
        <span class="n">batch</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>
        <span class="n">batch</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span>
            <span class="n">texture</span><span class="o">,</span>
            <span class="n">Gdx</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">texture</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()/</span><span class="mi">2</span><span class="o">,</span>
            <span class="n">Gdx</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">texture</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()/</span><span class="mi">2</span>
        <span class="o">);</span>
        <span class="n">batch</span><span class="o">.</span><span class="na">end</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resize</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpriteBatch</span><span class="o">();</span>
        <span class="n">texture</span> <span class="o">=</span> <span class="n">GameAssetManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;badlogic.jpg&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hide</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pause</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resume</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispose</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Текстуру из <em>AssetManager</em> получаем методом <em>get(String name)</em> при условии, что этот ресурс был загружен в менеджер.
Так же выровняем положение текстуры по центру экрана, <em>Gdx.graphics.getWidth()</em> возвращает ширину экрана, <em>texture.getWidth()</em> - ширину текстуры, так же получим высоту экрана и высоту текстуры. Вычисляем позицию текстуры.</p>
<p>Теперь наша "игра" использует менеджер экранов и менеджер игровых ресурсов, что не может не радовать.</p>
<p><img alt="результат" src="http://blog.rndspell.com/images/my_game_part2.png" title="результат" /></p>
<p>рис.3 Работающее приложение с использованием менеджера экранов и ресурсов.</p>
<p>Результат можно получить из моего репозитория на github.com:</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">part2</span> <span class="o">--</span><span class="n">single</span><span class="o">-</span><span class="n">branch</span> <span class="n">git</span><span class="err">@</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">:</span><span class="n">rndSPELL</span><span class="o">/</span><span class="n">libGDXGame</span><span class="p">.</span><span class="n">git</span>
</pre></div>


<p>Продолжение следует...</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Комментарии</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'rndspellblog'; // required: replace example with your forum shortname

                    var disqus_identifier = 'libgdx-game-from-scratch-part2';
                var disqus_url = 'http://blog.rndspell.com/posts/2014/07/libgdx-game-from-scratch-part2/';

            var disqus_config = function () {
                this.language = "ru";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Соцсети</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="https://twitter.com/rndSPELL"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
                  </ul>
                </li>



                <li class="list-group-item"><a href="http://blog.rndspell.com/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Тэги</span></h4></a>
                    <ul class="list-group " id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://blog.rndspell.com/tag/libgdx/">
                                libGDX
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://blog.rndspell.com/tag/gamedev/">
                                gamedev
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://blog.rndspell.com/tag/ecs/">
                                ECS
                            </a>
                        </li>
                    </ul>
                </li>    

    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </li>
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Ссылки</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://jinja.pocoo.org/" target="_blank">
                Jinja2
            </a>
        </li>
      </ul>
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Bserg
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.rndspell.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.rndspell.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.rndspell.com/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://blog.rndspell.com/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'rndSPELL',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://blog.rndspell.com/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rndspellblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-52846142-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>